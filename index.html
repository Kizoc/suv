<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è®¢é˜…è½¬æ¢å·¥å…· - é«˜çº§ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 to-pink-100 min-h-screen py-10 px-4">
  <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-2xl">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">âœ¨ è®¢é˜…è½¬æ¢å·¥å…·ï¼ˆé«˜çº§åˆ†äº«ç‰ˆï¼‰</h1>

    <!-- æ­¥éª¤ 1ï¼šè¾“å…¥è®¢é˜…é“¾æ¥ -->
    <label class="block font-semibold mb-1">æ­¥éª¤ 1ï¼šè®¢é˜…é“¾æ¥</label>
    <input id="subUrl" class="w-full mb-4 p-2 border rounded-lg" placeholder="è¾“å…¥æˆ–é€šè¿‡ç½‘å€å‚æ•°è‡ªåŠ¨å¡«å……" />
    <button onclick="decodeBase64()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl">è§£æå¹¶è§£ç </button>
    <pre id="decoded" class="bg-gray-100 mt-4 p-4 rounded text-sm max-h-40 overflow-auto">ç­‰å¾…è§£ç ...</pre>

    <!-- æ­¥éª¤ 2ï¼šç­›é€‰å…³é”®è¯ -->
    <label class="block font-semibold mt-6 mb-1">æ­¥éª¤ 2ï¼šç­›é€‰å…³é”®è¯ï¼ˆç”¨ | åˆ†éš”ï¼‰</label>
    <input id="keywords" class="w-full mb-4 p-2 border rounded-lg" value="è®¤å‡†|å…¨ç½‘|å®¢æœ|ç¾å¥³|mao|ç½‘å€|ç½‘ç«™|æœ€æ–°|è®¢é˜…|ç»­è´¹|com|è¿·è·¯|å®˜ç½‘|6|7|8|æµé‡|è¿‡æœŸ|å®˜ç½‘|è½åœ°|å›å›½|æœ¬ç«™|ç”¨æˆ·|è‹¥|é‚®ç®±|è®¢é˜…|å‰©ä½™|é¡¶çº§|æœºåœº|åˆ°æœŸ|çŒ«|èµ”é’±|è‰¯å¿ƒ|liangxin|äº‘|ä¸–ç•Œ|cloud|å¤æ—¥|summer" />
    <button onclick="function filterNodes() {
  const kw = document.getElementById('keywords').value.trim();
  const output = document.getElementById('filtered');
  const stats = document.getElementById('filterStats');
  if (!decodedText) {
    output.textContent = 'è¯·å…ˆè§£ç ';
    stats.textContent = '';
    return;
  }

  // å…³é”®è¯å°å†™å¤„ç†æ•°ç»„
  const keywords = kw
    .split('|')
    .map(k => k.trim().toLowerCase())
    .filter(k => k);

  const lines = decodedText.split('\n').map(l => l.trim()).filter(l => l);
  const total = lines.length;

  // è¿‡æ»¤é€»è¾‘
  const filteredLines = lines.filter(line => {
    const lowerLine = line.toLowerCase();

    // å‰”é™¤ hy2 å’Œ hysteria2 åè®®èŠ‚ç‚¹ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
    if (lowerLine.startsWith('hy2://') || lowerLine.startsWith('hysteria2://')) {
      return false;
    }

    // å¦‚æœèŠ‚ç‚¹åŒ…å«ä»»ä½•å…³é”®è¯ï¼Œå‰”é™¤
    if (keywords.some(kw => lowerLine.includes(kw))) {
      return false;
    }

    // é€šè¿‡ç­›é€‰
    return true;
  });

  filteredText = filteredLines.join('\n');
  output.textContent = filteredText || 'âš ï¸ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹';
  stats.textContent = `æ€»èŠ‚ç‚¹æ•°ï¼š${total}ï¼Œç­›é€‰åèŠ‚ç‚¹æ•°ï¼š${filteredLines.length}ï¼Œå‰”é™¤èŠ‚ç‚¹æ•°ï¼š${total - filteredLines.length}`;

  // æ¸…ç©ºåŠ å¯†ç»“æœå’Œåˆ†äº«é“¾æ¥
  encodedText = '';
  document.getElementById('encoded').textContent = 'ç­‰å¾…åŠ å¯†...';
  document.getElementById('sharelink').textContent = '';
}
()" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-xl">ç­›é€‰èŠ‚ç‚¹</button>
    <pre id="filtered" class="bg-gray-100 mt-4 p-4 rounded text-sm max-h-40 overflow-auto">ç­‰å¾…ç­›é€‰...</pre>
    <p id="filterStats" class="text-sm text-gray-600 mt-2"></p>

    <!-- æ­¥éª¤ 3ï¼šåŠ å¯†å¹¶ç”Ÿæˆåˆ†äº«é“¾æ¥ -->
    <button onclick="encodeBase64()" class="bg-green-600 hover:bg-green-700 text-white mt-6 px-4 py-2 rounded-xl">Base64 åŠ å¯†</button>
    <pre id="encoded" class="bg-gray-100 mt-4 p-4 rounded text-sm max-h-40 overflow-auto">ç­‰å¾…åŠ å¯†...</pre>

    <button onclick="copyShareUrl()" class="bg-gray-700 hover:bg-black text-white mt-4 px-4 py-2 rounded-xl">ğŸ”— å¤åˆ¶åˆ†äº«é“¾æ¥</button>
    <pre id="sharelink" class="text-xs text-gray-500 mt-2 whitespace-pre-wrap break-words"></pre>

    <p class="text-center text-gray-500 mt-10 text-sm">ç”± <span class="font-bold">æ— æ•Œå¤§å¸…æ¯”</span> åˆ¶ä½œ Â· æ”¯æŒ URL è‡ªåŠ¨è§£æå…³é”®è¯</p>
  </div>

  <script>
    let decodedText = '';
    let filteredText = '';
    let encodedText = '';

    window.onload = function () {
      const params = new URLSearchParams(window.location.search);
      const url = params.get('url');
      const kw = params.get('keywords');
      if (url) document.getElementById('subUrl').value = decodeURIComponent(url);
      if (kw) document.getElementById('keywords').value = decodeURIComponent(kw);
      if (url) decodeBase64();
    };

    async function decodeBase64() {
      const subUrl = document.getElementById('subUrl').value.trim();
      const output = document.getElementById('decoded');
      if (!subUrl.startsWith('http')) {
        output.textContent = 'âŒ é“¾æ¥æ— æ•ˆ';
        return;
      }
      output.textContent = 'æ­£åœ¨è§£æ...';
      try {
        const res = await fetch(subUrl);
        const raw = await res.text();
        decodedText = atob(raw);
        output.textContent = decodedText;
        // æ¸…ç©ºç­›é€‰å’ŒåŠ å¯†ç»“æœ
        filteredText = '';
        encodedText = '';
        document.getElementById('filtered').textContent = 'ç­‰å¾…ç­›é€‰...';
        document.getElementById('encoded').textContent = 'ç­‰å¾…åŠ å¯†...';
        document.getElementById('filterStats').textContent = '';
        document.getElementById('sharelink').textContent = '';
      } catch (e) {
        output.textContent = 'âŒ è§£ç å¤±è´¥: ' + e.message;
      }
    }

    function filterNodes() {
      const kw = document.getElementById('keywords').value.trim();
      const output = document.getElementById('filtered');
      const stats = document.getElementById('filterStats');
      if (!decodedText) {
        output.textContent = 'è¯·å…ˆè§£ç ';
        stats.textContent = '';
        return;
      }
      const keywords = kw.split('|').map(k => k.trim()).filter(k => k);
      const lines = decodedText.split('\n').filter(line => line.trim() !== '');
      const total = lines.length;

      const filteredLines = lines.filter(line => {
        if (line.startsWith('hy2://') || line.startsWith('hysteria2://')) {
          return false;
        }
        for (const kw of keywords) {
          if (line.includes(kw)) return false;
        }
        return true;
      });

      filteredText = filteredLines.join('\n');
      output.textContent = filteredText || 'âš ï¸ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹';
      stats.textContent = `æ€»èŠ‚ç‚¹æ•°ï¼š${total}ï¼Œç­›é€‰åèŠ‚ç‚¹æ•°ï¼š${filteredLines.length}ï¼Œå‰”é™¤èŠ‚ç‚¹æ•°ï¼š${total - filteredLines.length}`;
      // æ¸…ç©ºåŠ å¯†ç»“æœ
      encodedText = '';
      document.getElementById('encoded').textContent = 'ç­‰å¾…åŠ å¯†...';
      document.getElementById('sharelink').textContent = '';
    }

    function encodeBase64() {
      const output = document.getElementById('encoded');
      if (!filteredText) {
        output.textContent = 'è¯·å…ˆç­›é€‰';
        return;
      }
      encodedText = btoa(filteredText);
      output.textContent = encodedText;
    }

    function copyShareUrl() {
      const url = document.getElementById('subUrl').value.trim();
      const kw = document.getElementById('keywords').value.trim();
      const share = `${location.origin}${location.pathname}?url=${encodeURIComponent(url)}&keywords=${encodeURIComponent(kw)}`;
      navigator.clipboard.writeText(share);
      document.getElementById('sharelink').textContent = 'åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼š' + share;
    }
  </script>
</body>
</html>

